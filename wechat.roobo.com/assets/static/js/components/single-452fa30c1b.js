singlevm=new Vue({el:"html",data:{loading:!0,singledata:"",downloaddata:"",playtracklist:""},ready:function(){this.getdata(),this.initselectdata()},computed:{babateng:function(){return"babateng"==DEBUG||"dev"==DEBUG}},methods:{initselectdata:function(){var t=this,e=utils.gettrackList();console.log(e),e.length&&$.each(e,function(t,e){e.title=e.name,e.value=e.id}),t.playtracklist=e},getdata:function(){var t=this;$.ajax({url:juli.URL.getsingle+"/"+utils.getparam("id"),type:"get",dataType:"json",cache:!1}).done(function(e){e.islike=!1,e.isplay=!1,e.trackId=e.id,e.title=e.name,e.duration=e.length,e.sec=utils.formatSeconds(e.length),singlevm.singledata=e,utils.settitle(t.singledata.name)})},"try":function(){var t=document.getElementById("try");t.play(),this.singledata.isplay=!0},stoptry:function(){var t=document.getElementById("try");t.pause(),this.singledata.isplay=!1},demand:function(){utils.demand(this.singledata.id,this.singledata.content)},addfav:function(){if(!utils.getdevice())return $.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1;var t=this,e={openId:utils.openid,trackId:t.singledata.id,title:t.singledata.name,duration:t.singledata.length,url:t.singledata.content,downloadUrl:t.singledata.content,downloadSize:t.singledata.size};$.ajax({url:juli.URL.addlike,type:"post",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){$.toast("已添加收藏","text"),t.singledata.islike=!0})},dellike:function(){var t=this,e={trackId:t.singledata.id,openId:utils.openid};$.ajax({url:juli.URL.dellike,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(e)}).done(function(e){console.log(e),$.toast("删除收藏","text"),t.singledata.islike=!1})},download:function(t){var e=this;if(!utils.getdevice())return $.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1;var a=[{title:this.singledata.name,id:this.singledata.id,duration:this.singledata.length,url:this.singledata.content,downloadUrl:this.singledata.srcurl,downloadSize:this.singledata.size}];e.downloaddata=a,$("#select").select({title:"请选择播放列表",items:e.playtracklist,closeText:"取消",onChange:function(){e.downloadfun($("#select").val(),$("#select").data("values"))}}),$("#select").select("open")},downloadfun:function(t,e){var a=this;console.log(t),console.log(e),$.ajax({url:juli.URL.download+"?deviceId="+utils.getdevice()+"&id="+e+"&name="+encodeURI(encodeURI(t)),type:"post",async:!1,contentType:"application/json",data:JSON.stringify(a.downloaddata)}).done(function(t){console.log(t),$.toast("添加成功！","text"),utils.clearselect()})}}});