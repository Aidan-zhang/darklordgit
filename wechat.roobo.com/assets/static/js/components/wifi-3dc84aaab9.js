"use strict";function createAudio(){if("undefined"==typeof audio){var e=audiojs.create(document.getElementsByTagName("audio"),{});audio=e[0]}}function checkSsid(){var e=$("input[name=ssid]").val();return""==e?($("input[name=ssid]").parents(".weui_cell").addClass("weui_cell_warn"),!1):($("input[name=ssid]").parents(".weui_cell").removeClass("weui_cell_warn"),!0)}function onConnectCallback(){console.log("this is callback"),client.subscribe("storybox/"+window.deviceId+"/server")}function checkIfConnected(){console.log("checkIfConnected"),window.configResult?($.hideLoading(),$.toast("配置成功","text"),setTimeout(function(){audio.pause(),wx.closeWindow()},1e3)):$.showLoading("配置中")}function checkIfTimeout(){console.log("checkIfTimeout"),window.configResult||($.hideLoading(),audio.pause(),$.alert("配置超时，请重新连接","配置超时"))}function onConfigWifi(e){"success"==e&&(window.configResult=!0)}function playSinVoiceUrl(e,o){window.openId==o&&(audio.pause(),audio.setVolume(1),audio.load(e),audio.play())}wx.ready(function(){wx.hideOptionMenu()});var audio=void 0;createAudio(),$(function(){window.configResult=!1,$("input[name=ssid]").change(function(){checkSsid(),console.log(111)});var e=window.localStorage.getItem("ssid"),o=window.localStorage.getItem("ssidpassword");$("input[name=ssid]").val(e),$("input[name=password]").val(o),clientCreate(onConnectCallback)}),$("#btnConnect").click(function(){if(checkSsid()){var e=$("input[name=ssid]").val(),o=$("input[name=password]").val(),i=120,n={openId:window.openId,deviceId:window.deviceId,ssid:e,password:o};console.log(n),$.ajax({type:"POST",url:juli.URL.sinvoice,contentType:"application/json",async:!1,timeout:4e3,data:JSON.stringify(n),success:function(n){var t=n+"?date="+(new Date).getTime();console.log("fileUrl:"+t);var a=$(audio.element).attr("src");void 0!==a&&$(audio.element).attr("src",""),audio.load(t),audio.play();for(var c=0;c<i/2;c++)setTimeout(checkIfConnected,1e3*c*2);setTimeout(checkIfTimeout,1e3*(i+1)),window.localStorage.setItem("ssid",e),window.localStorage.setItem("ssidpassword",o)},error:function(e){}})}});