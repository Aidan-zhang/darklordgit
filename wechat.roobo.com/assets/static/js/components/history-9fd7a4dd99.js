historyvm=new Vue({el:"#j_history",data:{list:""},ready:function(){this.getdata()},methods:{getdata:function(){$.ajax({url:juli.URL.gethistory,type:"get",dataType:"json",cache:!1,data:{openId:utils.openid}}).done(function(t){$.each(t,function(t,a){a.sec=utils.formatSeconds(a.duration),a.isplay=!1,a.islike=!1}),historyvm.list=t})},demand:function(t){var a=this;$.each(a.list,function(t,a){a.isplay=!1});var i={openId:utils.openid,trackId:t.trackId};$.ajax({url:juli.URL.play+"?mediaId=",type:"POST",contentType:"application/json",async:!1,timeout:4e3,data:JSON.stringify(i),success:function(t){"ok"==t?$.toast("点播成功，请点击故事机上的播放按钮","text"):$.toast("点播失败提示","text")}})},addfav:function(t){t.openid=utils.openid;var a={openId:utils.openid,trackId:t.trackId,title:t.title,coverSmallUrl:t.coverSmallUrl,duration:t.duration,albumTitle:t.albumTitle,albumCoverSmallUrl:t.albumCoverSmallUrl,url:t.url,downloadUrl:t.downloadUrl,downloadSize:t.downloadSize};$.ajax({url:juli.URL.addlike,type:"post",contentType:"application/json",data:JSON.stringify(a)}).done(function(a){$.toast("已添加收藏","text"),t.islike=!0})},dellike:function(t){var a={trackId:t.trackId,openId:utils.openid};$.ajax({url:juli.URL.dellike,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(a)}).done(function(a){$.toast("删除收藏","text"),t.islike=!1})},download:function(t){var a=[{title:t.title,id:t.trackId,duration:t.duration,albumTitle:t.albumTitle,albumCoverSmallUrl:t.albumCoverSmallUrl,url:t.url,downloadUrl:t.downloadUrl,downloadSize:t.downloadSize}];$.ajax({url:juli.URL.download+"?deviceId="+utils.getdevice()+"&id="+utils.trackListId()+"&name="+encodeURI(encodeURI(utils.tracklist)),type:"post",contentType:"application/json",data:JSON.stringify(a)}).done(function(t){$.toast("添加成功！","text")})},del:function(t){var a=this,i={openId:utils.openid,trackId:t.trackId,deviceId:utils.getdevice()};$.ajax({url:juli.URL.delhistory,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(i)}).done(function(t){$.toast("删除成功","text"),a.getdata()})}}});