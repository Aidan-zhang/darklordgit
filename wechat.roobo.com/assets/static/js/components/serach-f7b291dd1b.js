searchVM=new Vue({el:"#j_search",data:{searchdata:"",list:"",input:"",historylist:"",showsearch:"",downloaddata:"",playtracklist:""},ready:function(){this.decide("url"),this.initselectdata()},computed:{babateng:function(){return"babateng"==DEBUG||"dev"==DEBUG}},methods:{initselectdata:function(){var t=this,e=utils.gettrackList();console.log(e),e.length&&$.each(e,function(t,e){e.title=e.name,e.value=e.id}),t.playtracklist=e},decide:function(t){"url"==t?(this.searchdata=utils.getparam("search"),this.input=this.searchdata):this.searchdata=this.input,""==this.searchdata?this.searchhistory():this.search()},searchhistory:function(){var t=this;$.ajax({url:juli.URL.getsearch+"/"+utils.openid+"/"+utils.getdevice(),type:"get",cache:!1}).done(function(e){console.log(e),t.showsearch=!1,t.historylist=e})},addhistory:function(){var t=this,e={openId:utils.openid,deviceId:utils.getdevice(),keyword:t.searchdata};$.ajax({url:juli.URL.savesearch,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(e)}).done(function(t){})},clearhistory:function(){var t=this;$.ajax({url:juli.URL.clearsearch+"/"+utils.openid+"/"+utils.getdevice(),type:"get",cache:!1,data:{openId:utils.openid,deviceId:utils.getdevice()}}).done(function(e){console.log(e),$.toast("已清除搜索记录","text"),t.searchhistory()})},searchbyhistory:function(t){this.searchdata=t.keyword,this.search()},search:function(){var t=this;$.ajax({url:juli.URL.search+t.searchdata,type:"get",cache:!1,contentType:"application/json"}).done(function(e){console.log(e),$.each(e.data.resources,function(t,e){e.sec=utils.formatSeconds(e.length),e.isexpand=!1,e.isplay=!1,e.islike=!1}),t.list=e,t.showsearch=!0,t.addhistory()})},toggleopen:function(t){$.each(this.list.data.resources,function(t,e){e.isexpand=!1}),t.isexpand=!t.isexpand},"try":function(t){$.each(this.list.data.resources,function(t,e){e.isplay=!1});var e=document.getElementById("try");e.src=t.content,e.play(),t.isplay=!0,e.onended=function(){t.isplay=!1}},stoptry:function(t){var e=document.getElementById("try");e.pause(),t.isplay=!1},demand:function(t){utils.demand(t.id,t.content)},addfav:function(t){if(!utils.getdevice())return $.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1;var e={openId:utils.openid,trackId:t.id,title:t.name,duration:t.length,url:t.content,downloadUrl:t.content,downloadSize:t.size};$.ajax({url:juli.URL.addlike,type:"post",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){$.toast("已添加收藏","text"),t.islike=!0})},dellike:function(t){var e={trackId:t.id,openId:utils.openid};$.ajax({url:juli.URL.dellike,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(e)}).done(function(e){console.log(e),$.toast("已删除收藏","text"),t.islike=!1})},download:function(t){var e=this;if(!utils.getdevice())return $.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1;var a=[{title:t.name,id:t.id,duration:t.length,url:t.content,downloadUrl:t.content,downloadSize:t.size}];e.downloaddata=a,$("#select").select({title:"请选择播放列表",items:e.playtracklist,closeText:"取消",onChange:function(){e.downloadfun($("#select").val(),$("#select").data("values"))}}),$("#select").select("open")},downloadfun:function(t,e){var a=this;console.log(t),console.log(e),$.ajax({url:juli.URL.download+"?deviceId="+utils.getdevice()+"&id="+e+"&name="+encodeURI(encodeURI(t)),type:"post",async:!1,contentType:"application/json",data:JSON.stringify(a.downloaddata)}).done(function(t){console.log(t),$.toast("添加成功！","text"),utils.clearselect()})},href:function(t){location.href="single.html?id="+t.id}}});