"use strict";function createAudio(){if("undefined"==typeof audio){var e=audiojs.create(document.getElementsByTagName("audio"),{});audio=e[0]}}function checkSsid(){var e=$("input[name=ssid]").val();return""==e?($("input[name=ssid]").parents(".weui_cell").addClass("weui_cell_warn"),!1):($("input[name=ssid]").parents(".weui_cell").removeClass("weui_cell_warn"),!0)}function onConnectCallback(){client.subscribe("storybox/"+window.deviceId+"/server")}function checkIfConnected(){window.configResult?($.hideLoading(),$.toast("配置成功","text"),setTimeout(function(){audio.pause(),wx.closeWindow()},1e3)):$.showLoading("配置中")}function checkIfTimeout(){window.configResult||($.hideLoading(),audio.pause(),$.alert("配置超时，请重新连接","配置超时"))}function onConfigWifi(e){"success"==e&&(window.configResult=!0)}function playSinVoiceUrl(e,i){window.openId==i&&(audio.pause(),audio.setVolume(1),audio.load(e),audio.play())}wx.ready(function(){wx.hideOptionMenu()});var audio=void 0;createAudio(),$(function(){window.configResult=!1,$("input[name=ssid]").change(function(){checkSsid()}),clientCreate(onConnectCallback)}),$("#btnConnect").click(function(){if(checkSsid()){var e=$("input[name=ssid]").val(),i=$("input[name=password]").val(),n=120,o={openId:window.openId,deviceId:window.deviceId,ssid:e,password:i};$.ajax({type:"POST",url:"http://wechat.roobo.com/storybox/sinvoice/set.do",contentType:"application/json",async:!1,timeout:4e3,data:JSON.stringify(o),success:function(e){var i=e;setTimeout(function(){audio.load(i),audio.play()},2e3);for(var o=0;o<n/2;o++)setTimeout(checkIfConnected,1e3*o*2);setTimeout(checkIfTimeout,1e3*(n+1))},error:function(e){}})}});