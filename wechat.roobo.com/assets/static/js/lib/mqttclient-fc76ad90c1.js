function onConnect(){console.log("onConnect"),""!=window.deviceId&&client.subscribe("storybox/"+window.deviceId+"/client"),onConnectCallback&&onConnectCallback()}function onFailure(){var n=new Date;console.log(n+" failure,try to reclient"),clientConnect()}function onConnectionLost(){clientConnect()}function onMessageDelivered(n){alert("发送成功")}function clientCreate(n){if(WebSocketCheck())client.onMessageArrived=onMessageArrived,n=n,clientConnect();else{var e='<div class="alert alert-danger notSupportWebSocket"><span>抱歉，您的浏览器不支持某些重要特性，有些功能无法正常使用</span></div>';$("body").find("div").eq(0).before(e)}}function clientConnect(){try{client.connect({cleanSession:!1,onSuccess:onConnect,onFailure:onFailure})}catch(n){console.log(n)}}function clientPublish(n){if(WebSocketCheck()){var e=JSON.stringify(n);if(console.log(e),""!=window.deviceId){var t=new Paho.MQTT.Message(e),o="storybox/"+window.deviceId+"/server/page";t.destinationName=o;try{console.log(),client.send(t)}catch(a){console.log(a)}}}}function WebSocketCheck(){return"WebSocket"in window}function onMessageArrived(n){console.log("onMessageArrived:"+n.payloadString);try{var e=JSON.parse(n.payloadString);console.log(e),e.hasOwnProperty("onlineStatus")?onlineStatus_change&&onlineStatus_change(e.onlineStatus):e.hasOwnProperty("boxInfo")?showBoxInfo&&showBoxInfo(e.boxInfo):e.hasOwnProperty("volume")?currentVolumeDisplay&&currentVolumeDisplay(e.volume):e.hasOwnProperty("trackListId")&&e.hasOwnProperty("trackId")&&e.hasOwnProperty("type")?playTrack_change&&playTrack_change(e.trackListId,e.trackId,e.type):e.hasOwnProperty("playStatus")?playStatus_change&&playStatus_change(e.playStatus):e.hasOwnProperty("mode")?mode_change&&mode_change(e.mode):e.hasOwnProperty("downloadStatus")&&e.hasOwnProperty("trackId")?after_download&&after_download&&after_download(e.downloadStatus,e.trackId):e.hasOwnProperty("configWifi")?onConfigWifi&&onConfigWifi(e.configWifi):e.hasOwnProperty("playSinVoiceUrl")&&e.hasOwnProperty("openId")?(console.log("------------------------------------"),playSinVoiceUrl&&playSinVoiceUrl(e.playSinVoiceUrl,e.openId)):e.hasOwnProperty("cmd")&&e.hasOwnProperty("trackListId")&&e.hasOwnProperty("trackIds")&&"initialTrackList"==e.cmd&&startInitialTrackList&&startInitialTrackList(e.trackListId,e.trackIds)}catch(t){console.log(t)}}function playTrack(n,e,t,o){var a={cmd:"playTrack",trackListId:n,trackId:e,url:t,downloadUrl:o};clientPublish(a)}function forwardTrack(){var n={cmd:"forward"};clientPublish(n)}function backwardTrack(){var n={cmd:"backward"};clientPublish(n)}function pauseTrack(){var n={cmd:"pause"};clientPublish(n)}function resumeTrack(){var n={cmd:"resume"};clientPublish(n)}function queryTrack(){var n={cmd:"getTrack"};clientPublish(n)}function queryPlayStatus(){var n={cmd:"getPlayStatus"};clientPublish(n)}function queryMode(){var n={cmd:"getMode"};clientPublish(n)}function setRepeatall(){var n={cmd:"setMode",value:"repeat all"};clientPublish(n)}function setRepeatone(){var n={cmd:"setMode",value:"repeat one"};clientPublish(n)}function cmd_poweroff(){var n={cmd:"setPoweroff"};clientPublish(n)}function cmd_setvolume(n){var e={cmd:"setVolume",value:n};clientPublish(e)}function getOnlineStatus(){var n={cmd:"getOnlineStatus"};clientPublish(n)}function getBoxInfo(){var n={cmd:"getBoxInfo"};clientPublish(n)}function boxUpgrade(n,e){var t={cmd:"upgrade",versionName:n,firmwareUrl:e};clientPublish(t)}function getInitialTrackList(n){n=parseInt(n);var e={cmd:"getInitialTrackList",trackListId:n};clientPublish(e)}function playTracks(n){var e={cmd:"playTracks",trackIds:n};clientPublish(e)}var clientId=(new Date).getTime().toString(),client=new Paho.MQTT.Client(window.juli.MQTT,window.juli.MQTTPORT,clientId);client.onConnectionLost=onConnectionLost;var onConnectCallback;